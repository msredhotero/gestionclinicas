<?php

session_start();

if (!isset($_SESSION['usua_sahilices']))
{
	header('Location: ../../error.php');
} else {


include ('../../includes/funciones.php');
include ('../../includes/funcionesUsuarios.php');
include ('../../includes/funcionesHTML.php');
include ('../../includes/funcionesReferencias.php');
include ('../../includes/base.php');
include ('../../includes/funcionesComercio.php');

$serviciosFunciones 	= new Servicios();
$serviciosUsuario 		= new ServiciosUsuarios();
$serviciosHTML 			= new ServiciosHTML();
$serviciosReferencias 	= new ServiciosReferencias();
$baseHTML = new BaseHTML();
$serviciosComercio      = new serviciosComercio();

//*** SEGURIDAD ****/
include ('../../includes/funcionesSeguridad.php');
$serviciosSeguridad = new ServiciosSeguridad();
$serviciosSeguridad->seguridadRuta($_SESSION['refroll_sahilices'], '../ecommerce/');
//*** FIN  ****/

$fecha = date('Y-m-d');

$EM_Response= $_POST["EM_Response"];
$EM_Total= $_POST["EM_Total"];
$EM_OrderID= $_POST["EM_OrderID"];
$EM_Merchant= $_POST["EM_Merchant"];
$EM_Store= $_POST["EM_Store"];
$EM_Term= $_POST["EM_Term"];
$EM_RefNum= $_POST["EM_RefNum"];
$EM_Auth= $_POST["EM_Auth"];
$EM_Digest= $_POST["EM_Digest"];

$newdigest  = sha1($_POST["EM_Total"].$_POST["EM_OrderID"].$_POST["EM_Merchant"].$_POST["EM_Store"].$_POST["EM_Term"].$_POST["EM_RefNum"]+"-"+$_POST["EM_Auth"]);

$resultado = $serviciosComercio->traerComerciofinPorOrderId($EM_OrderID);


$error = 0;
$lblError = '';

$instanciaDelError = 0;

switch ($EM_Response) {
   case 'Incorrect Information is provided.':
      $error = 1;
      $lblError = 'La informacion que proporciono de la tarjeta es incorrecta, vuelva a intentarlo';
      $instanciaDelError = 1;
   break;
   case 'denied':
      $error = 1;
      $lblError = 'Su tarjeta fue rechazada, intente con otra tarjeta';
      $instanciaDelError = 2;
   break;
   case 'Duplicated transaction':
      $error = 1;
      $lblError = 'Se genero un error, nos comunicaremos con usted en la brevedad';
      $instanciaDelError = 3;
   break;
   case 'approved':
      $error = 0;
      $lblError = '';
   break;
}


if ($error == 0) {

} else {

}


?>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

    <title>PAGOS - ASESORES CREA</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/pricing/">

    <!-- Bootstrap core CSS -->
    <link href="../bootstrap-4.0.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../bootstrap-4.0.0/dist/css/pricing.css" rel="stylesheet">
  </head>

  <body>

    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow" style="background-color:#1b2646 !important; color:white !important;">
      <h5 class="my-0 mr-md-auto font-weight-normal"><img src="../../imagenes/logo-blanco.png" width="220" alt="logo"></h5>

      <a class="btn btn-outline-primary" href="#">Sign in</a>
    </div>

   <?php if ($error == 0) { ?>
    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
      <h1 class="display-4">Ya procesamos tu pago Correctamente</h1>
      <p class="lead">Desde Asesores CREA nos estaremos comunicando con usted para concluir el servicio.</p>
    </div>

   <?php } else { ?>
      <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
        <h1 class="display-4"><?php echo $lblError; ?></h1>
        <p class="lead">Desde Asesores CREA nos estaremos comunicando con usted para ayudarlo.</p>
      </div>
      <?php if ($instanciaDelError == 3) { ?>
      <div class="container">
         <div class="card-deck mb-3 text-center">
           <div class="card mb-12 box-shadow">
             <div class="card-header">
               <h4 class="my-0 font-weight-normal">Resumen del Pedido: VRIM Tarjeta PLATINO</h4>
             </div>
             <div class="card-body">
               <h1 class="card-title pricing-card-title">MX$1600.00</h1>
               <ul class="list-unstyled mt-3 mb-4">
                 <li>Seguro personal por muerte accidental de $500,000 pesos. (Aplica de 12 a 70 años)</li>
                 <li>Reembolso de GMM por accidente hasta $50,000 pesos. (Aplica de 0 a 70 años)</li>
                 <li>Seguro de pérdida de miembros escala “B” por accidente de $200,000 pesos. (Aplica de 0 a 70 años)</li>
               </ul>
               <hr>
               <p><small>Al realizar la compra, aceptas nuestros Terminos de uso. Procesaremos sus datos personales para el cumplimiento de su pedido y otros fines según nuestra Política de privacidad. Al concretar tu compra estarás aceptando nuestros Términos de servicio y Política de privacidad.</small></p>
               <ul class="d-flex flex-column flex-md-row">
                  <li class="list-inline-item"><img src="../../imagenes/visa.png" width="90" height="63"></li>
                  <li class="list-inline-item"><img src="../../imagenes/mastercard.png" width="90" height="63"></li>
                  <li class="list-inline-item"><img src="../../imagenes/Carnet.png" width="90" height="63"></li>
               </ul>
               <form action="../pay/xxxxxx_comercio.php" method="post" id="formFin">
                  <input type="hidden" name="total" value="<?php echo $comtotal; ?>">
                  <input type="hidden" name="currency" value="<?php echo $comcurrency; ?>">
                  <input type="hidden" name="address" value="<?php echo $comaddress; ?>">
                  <input type="hidden" name="order_id" value="<?php echo $comorder_id; ?>">
                  <input type="hidden" name="merchant" value="<?php echo $commerchant; ?>">
                  <input type="hidden" name="store" value="<?php echo $comstore; ?>">
                  <input type="hidden" name="term" value="<?php echo $comterm; ?>">
                  <input type="hidden" name="digest" value="<?php echo $comdigest; ?>">
                  <input type="hidden" name="return_target" value="">
                  <input type="hidden" name="urlBack" value="../pay/comercio_con.php">
                  <button type="button" class="btn btn-lg btn-block btn-success">Adquirir AHORA</button>
               </form>
             </div>
           </div>


         </div>

         <footer class="pt-4 my-md-5 pt-md-5 border-top">
           <div class="row">
             <div class="col-12 col-md">
               <div style="font-weight:normal;font-style:normal">© CREA | Asesores en Banca y Seguros 2020</div>
             </div>

           </div>
         </footer>
      </div>
      <?php } ?>

   <?php } ?>




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="../bootstrap-4.0.0/assets/js/vendor/popper.min.js"></script>
    <script src="../bootstrap-4.0.0/dist/js/bootstrap.min.js"></script>
    <script src="../bootstrap-4.0.0/assets/js/vendor/holder.min.js"></script>
    <script>
      Holder.addTheme('thumb', {
        bg: '#55595c',
        fg: '#eceeef',
        text: 'Thumbnail'
      });
    </script>
  </body>
</html>

<?php } ?>
